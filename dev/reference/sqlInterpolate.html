<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Safely interpolate values into an SQL string — sqlInterpolate • DBI</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Safely interpolate values into an SQL string — sqlInterpolate" />
<meta property="og:description" content="Accepts a query string with placeholders for values, and returns a string
with the values embedded.
The function is careful to quote all of its inputs with dbQuoteLiteral()
to protect against SQL injection attacks.
Placeholders can be specified with one of two syntaxes:
?: each occurrence of a standalone ? is replaced with a value
?name1, ?name2, ...: values are given as named arguments or a
named list, the names are used to match the values


Mixing ? and ?name syntaxes is an error.
The number and names of values supplied must correspond to the placeholders
used in the query." />


<meta name="robots" content="noindex">



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DBI</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/DBI.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/DBI-1.html">A Common Database Interface (DBI)</a>
    </li>
    <li>
      <a href="../articles/DBI-advanced.html">Advanced DBI Usage</a>
    </li>
    <li>
      <a href="../articles/DBI-history.html">History of DBI</a>
    </li>
    <li>
      <a href="../articles/DBI-proposal.html">A Common Interface to Relational Databases from R and S -- A Proposal</a>
    </li>
    <li>
      <a href="../articles/backend.html">Implementing a new backend</a>
    </li>
    <li>
      <a href="../articles/spec.html">DBI specification</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-dbi/DBI/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Safely interpolate values into an SQL string</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-dbi/DBI/blob/master/R/interpolate.R'><code>R/interpolate.R</code></a></small>
    <div class="hidden name"><code>sqlInterpolate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Accepts a query string with placeholders for values, and returns a string
with the values embedded.
The function is careful to quote all of its inputs with <code><a href='dbQuoteLiteral.html'>dbQuoteLiteral()</a></code>
to protect against SQL injection attacks.</p>
<p>Placeholders can be specified with one of two syntaxes:</p><ul>
<li><p><code>?</code>: each occurrence of a standalone <code>?</code> is replaced with a value</p></li>
<li><p><code>?name1</code>, <code>?name2</code>, ...: values are given as named arguments or a
named list, the names are used to match the values</p></li>
</ul>

<p>Mixing <code>?</code> and <code><a href='https://rdrr.io/r/base/name.html'>?name</a></code> syntaxes is an error.
The number and names of values supplied must correspond to the placeholders
used in the query.</p>
    </div>

    <pre class="usage"><span class='fu'>sqlInterpolate</span><span class='op'>(</span><span class='va'>conn</span>, <span class='va'>sql</span>, <span class='va'>...</span>, .dots <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>conn</th>
      <td><p>A <a href='DBIConnection-class.html'>DBIConnection</a> object, as returned by
<code><a href='dbConnect.html'>dbConnect()</a></code>.</p></td>
    </tr>
    <tr>
      <th>sql</th>
      <td><p>A SQL string containing variables to interpolate.
Variables must start with a question mark and can be any valid R
identifier, i.e. it must start with a letter or <code>.</code>, and be followed
by a letter, digit, <code>.</code> or <code>_</code>.</p></td>
    </tr>
    <tr>
      <th>..., .dots</th>
      <td><p>Values (for <code>...</code>) or a list (for <code>.dots</code>)
to interpolate into a string.
Names are required if  <code>sql</code> uses the <code><a href='https://rdrr.io/r/base/name.html'>?name</a></code> syntax for placeholders.
All values will be first escaped with <code><a href='dbQuoteLiteral.html'>dbQuoteLiteral()</a></code> prior
to interpolation to protect against SQL injection attacks.
Arguments created by <code><a href='SQL.html'>SQL()</a></code> or <code><a href='dbQuoteIdentifier.html'>dbQuoteIdentifier()</a></code> remain unchanged.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The <code>sql</code> query with the values from <code>...</code> and <code>.dots</code> safely
embedded.</p>
    <h2 class="hasAnchor" id="backend-authors"><a class="anchor" href="#backend-authors"></a>Backend authors</h2>

    

<p>If you are implementing an SQL backend with non-ANSI quoting rules, you'll
need to implement a method for <code><a href='sqlParseVariables.html'>sqlParseVariables()</a></code>. Failure to
do so does not expose you to SQL injection attacks, but will (rarely) result
in errors matching supplied and interpolated variables.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>sql</span> <span class='op'>&lt;-</span> <span class='st'>"SELECT * FROM X WHERE name = ?name"</span>
<span class='fu'>sqlInterpolate</span><span class='op'>(</span><span class='fu'><a href='ANSI.html'>ANSI</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>sql</span>, name <span class='op'>=</span> <span class='st'>"Hadley"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;SQL&gt; SELECT * FROM X WHERE name = 'Hadley'</div><div class='input'>
<span class='co'># This is safe because the single quote has been double escaped</span>
<span class='fu'>sqlInterpolate</span><span class='op'>(</span><span class='fu'><a href='ANSI.html'>ANSI</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>sql</span>, name <span class='op'>=</span> <span class='st'>"H'); DROP TABLE--;"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;SQL&gt; SELECT * FROM X WHERE name = 'H''); DROP TABLE--;'</div><div class='input'>
<span class='co'># Using paste0() could lead to dangerous SQL with carefully crafted inputs</span>
<span class='co'># (SQL injection)</span>
<span class='va'>name</span> <span class='op'>&lt;-</span> <span class='st'>"H'); DROP TABLE--;"</span>
<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"SELECT * FROM X WHERE name = '"</span>, <span class='va'>name</span>, <span class='st'>"'"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "SELECT * FROM X WHERE name = 'H'); DROP TABLE--;'"</div><div class='input'>
<span class='co'># Use SQL() or dbQuoteIdentifier() to avoid escaping</span>
<span class='va'>sql2</span> <span class='op'>&lt;-</span> <span class='st'>"SELECT * FROM ?table WHERE name in ?names"</span>
<span class='fu'>sqlInterpolate</span><span class='op'>(</span><span class='fu'><a href='ANSI.html'>ANSI</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>sql2</span>,
  table <span class='op'>=</span> <span class='fu'><a href='dbQuoteIdentifier.html'>dbQuoteIdentifier</a></span><span class='op'>(</span><span class='fu'><a href='ANSI.html'>ANSI</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='st'>"X"</span><span class='op'>)</span>,
  names <span class='op'>=</span> <span class='fu'><a href='SQL.html'>SQL</a></span><span class='op'>(</span><span class='st'>"('a', 'b')"</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;SQL&gt; SELECT * FROM "X" WHERE name in ('a', 'b')</div><div class='input'>
<span class='co'># Don't use SQL() to escape identifiers to avoid SQL injection</span>
<span class='fu'>sqlInterpolate</span><span class='op'>(</span><span class='fu'><a href='ANSI.html'>ANSI</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='va'>sql2</span>,
  table <span class='op'>=</span> <span class='fu'><a href='SQL.html'>SQL</a></span><span class='op'>(</span><span class='st'>"X; DELETE FROM X; SELECT * FROM X"</span><span class='op'>)</span>,
  names <span class='op'>=</span> <span class='fu'><a href='SQL.html'>SQL</a></span><span class='op'>(</span><span class='st'>"('a', 'b')"</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;SQL&gt; SELECT * FROM X; DELETE FROM X; SELECT * FROM X WHERE name in ('a', 'b')</div><div class='input'>
<span class='co'># Use dbGetQuery() or dbExecute() to process these queries:</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"RSQLite"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>con</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dbConnect.html'>dbConnect</a></span><span class='op'>(</span><span class='fu'>RSQLite</span><span class='fu'>::</span><span class='fu'><a href='https://rsqlite.r-dbi.org/reference/SQLite.html'>SQLite</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>sql</span> <span class='op'>&lt;-</span> <span class='st'>"SELECT ?value AS value"</span>
  <span class='va'>query</span> <span class='op'>&lt;-</span> <span class='fu'>sqlInterpolate</span><span class='op'>(</span><span class='va'>con</span>, <span class='va'>sql</span>, value <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'><a href='dbGetQuery.html'>dbGetQuery</a></span><span class='op'>(</span><span class='va'>con</span>, <span class='va'>query</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'><a href='dbDisconnect.html'>dbDisconnect</a></span><span class='op'>(</span><span class='va'>con</span><span class='op'>)</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt;   value
#&gt; 1     3</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by R Special Interest Group on Databases (R-SIG-DB), <a href='http://hadley.nz'>Hadley Wickham</a>, <a href='http://krlmlr.info'>Kirill Müller</a>, <a href='https://www.r-consortium.org'>R Consortium</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


